<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Face Login</title>
    <!-- Latest compiled and minified CSS -->
    <style>
  /* Reset default margin and padding */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Body styles */
  body {
    font-family: 'Arial', sans-serif;
    background-color: #f4f4f4; /* Light background */
    color: #333; /* Darker text for better readability */
  }

  /* Navbar styles */
  .navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #007BFF;
    padding: 10px 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .logo {
    display: flex;
    align-items: center;
    color: white;
  }

  .logo img {
    height: 30px;
    margin-right: 10px;
  }

  .navbar a {
    color: #f2f2f2;
    text-decoration: none;
    font-size: 17px;
    padding: 10px;
  }

  .navbar a:hover {
    background-color: #0056b3;
    border-radius: 5px;
  }

  /* Main content frame */
  .display-frame {
    margin-top: 60px; /* Adjust for navbar */
    padding: 20px;
    max-width: 600px; /* Center and limit width */
    margin-left: auto;
    margin-right: auto;
    background-color: #fff; /* White background for content */
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0 0 10px rgba(0, 0, 0, 1); /* Subtle shadow */
  }

  /* Heading styles */
  .heading {
    text-align: center;
    margin-bottom: 20px;
  }

  .heading h1 {
    color: #007BFF;
    margin-bottom: 10px;
  }

  /* Form styles */
  form {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .username-input {
    width: 90%;
    height:3rem;
    padding: 8px;
    margin-bottom: 20px;
    border-radius: 4px;
    border:2px solid black;
    
  }

  .capture {
    margin-bottom: 20px;
  }

  /* Submit button styles */
  .submit-btn {
    background-color: #007BFF;
    color: white;
    width: 100%;
    height: 2.5rem;
    border-radius: 0.5rem;
    margin-top: 1rem;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease; /* Smooth transition for hover effect */
    margin-bottom:2rem;
  }

  .submit-btn:hover {
    background-color: #0056b3;
  }

  /* Footer styles */
  .footer {
    background-color: #007BFF;
    color: #f2f2f2;
    text-align: center;
    padding: 10px;
    position: fixed;
    bottom: 0;
    width: 100%;
  }

  .profile {
    width: 35%;
    height: 40%;
    border-radius: 5rem;
    margin-top: 1rem;
    display: flex;
    justify-content: center; /* Center the video */
    align-items: center; /* Center the video vertically */
  }

  .video {
    height: 100%;
    width: 100%;
    border-radius: 50%;
    object-fit: cover;
  }

  .profile img {
    width: 100%;
    height: 100%;
    border-radius: 50%; /* Makes the image circular */
    object-fit: cover; /* Ensures the image covers the circular area completely */
  }

  /* Additional styles for better visual appeal */
  .heading h1 {
    font-size: 2.5rem; /* Larger font size for the heading */
  }

  .submit-btn {
    font-weight: bold; /* Bold text for the button */
  }

  .footer {
    background-color: #007BFF;
    color: #f2f2f2;
    text-align: center;
    padding: 10px;
    position: fixed;
    bottom: 0;
    width: 100%;
    box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1); /* Add shadow to footer for depth */
  }

  .footer p {
    margin: 0; /* Remove default margin */
  }

  .footer a {
    color: #f2f2f2;
    text-decoration: none;
  }

  .footer a:hover {
    text-decoration: underline; /* Underline links on hover */
  }
  .record {
    display: flex;
    justify-content: center;
    align-items:center;
    padding:0.5rem;
    height:3rem;
    width:10rem;
    border-radius:1rem;
    margin-top:2rem;
    
    background-color: #007BFF;
    color: white;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    margin-bottom: 20px; /* Add space below the record button */
}

.record:hover {
    background-color: #0056b3;
}

</style>
  </head>
  <body>
    <div class="navbar">
      <div class="logo">
          <img src="https://cdn3.iconfinder.com/data/icons/web-con-set-98-solid/128/authorized_permission_permit_allow_recognize_verify_approve_accept_fingerprint_authentication_scan-512.png" alt="Logo">
          <h2>AuthGuard</h2>
      </div>
      <a href="/">Home</a>
  
  </div>
  <div class="display-frame">
      <div class="heading">
          
              <h1 class="my-2">Face ID Login</h1>
              <form id="login-form">
                <div class="profile" id="profile" >
                  <video id="video"class="video"  autoplay></video>
              </div>
              <input type="text" class="username-input" name="username" id="username" placeholder="Enter your username here" style="margin-top:1rem;" />
                <div id="capture" class="record" name="rimage">
                  <p >Capture Image<p>
              </div>
                <button class="submit-btn" type="button" id="submit">Submit</button>
                
              </form>
              <a href="/facesignup" class="switch" style="text-decoration:none;color:#007BFF; margin-top:2rem;">
                <p>Does'nt have an Account ? Face Signup here</p>
            </a>
          

      </div>
      <!-- <h1>Please Upload a image for Registering your Face</h1> -->

 
  </div>
  <div class="footer">
      <p>Â© AuthGuard. All rights reserved.</p>
      <p><a href="/privacy" style="color: #f2f2f2;">Privacy Policy</a> | <a href="/terms" style="color: #f2f2f2;">Terms of Service</a></p>
  </div>
</body>

    <script>
      const video = document.getElementById('video');
    const captureButton = document.getElementById('capture');
    const profileimage = document.getElementById('profile');
    let mediaStream;
    let imageURL;
    let blob;
    const constraints = {
        video: true,
    };

    async function initCamera() {
        try {
            mediaStream = await navigator.mediaDevices.getUserMedia(constraints);
            handleSuccess(mediaStream);
        } catch (error) {
            console.error('Error accessing camera: ', error);
        }
    }

    function handleSuccess(stream) {
        video.srcObject = stream;
    }

    function captureImage() {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        imageURL = canvas.toDataURL('image/jpeg');
        const capturedImage = new Image();
        capturedImage.src = imageURL;
        console.log(capturedImage);

        profileimage.innerHTML = ''; // Clear existing content inside profile div
        profileimage.appendChild(capturedImage);
        //Image = profileImage.querySelector('img');
        stopCamera();
    }

    function stopCamera() {
        if (mediaStream) {
            mediaStream.getTracks().forEach(track => track.stop());
        }
    }

    captureButton.addEventListener('click', captureImage);

    initCamera();

    document.getElementById('submit').addEventListener('click', function(event) {
      event.preventDefault(); // Prevent default form submission

      const form = document.querySelector('form');
      const formData = new FormData(form); // Create FormData object

      const imageData = dataURItoBlob(imageURL);
      formData.append('image', imageData, 'image.jpeg'); // Append image data to FormData

      // Get audio data
     // Append audio data to FormData

      fetch('/facelogin', {
          method: 'POST',
          body: formData
      }).then(res => {
          if (res.ok) { // Check if registration was successful
              window.location.href="/dashboard"
          } else {
              throw new Error('Registration failed');
          }
      }).catch(error => {
          console.error('Error:', error);
      });
  });

  function dataURItoBlob(dataURI) {
      const byteString = atob(dataURI.split(',')[1]);
      const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) {
          ia[i] = byteString.charCodeAt(i);
      }
      return new Blob([ab], { type: mimeString });
  }

    </script>
  </body>
</html>
